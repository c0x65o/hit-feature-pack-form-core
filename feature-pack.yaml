# Feature Pack: form-core
# Runtime-configurable custom forms (builder + CRUD entries)

name: form-core
title: System Custom Forms
description: Runtime Forms feature pack with builder + CRUD entries + search + reference linking

# Route definitions - mapped to React components
routes:
  # Form management routes - admin only
  - path: /forms
    page: FormList
    roles: [admin]
    default_roles_allow: [admin]
    authz: { entity: forms, verb: read, require_mode: any }
  - path: /forms/new
    page: FormBuilder
    roles: [admin]
    default_roles_allow: [admin]
    authz: { entity: forms, verb: write, require_create: true, require_mode: any }
  - path: /forms/[id]
    page: FormBuilder
    roles: [admin]
    default_roles_allow: [admin]
    authz: { entity: forms, verb: write, require_mode: any }
  # Entry routes - accessible based on form ACLs (checked at runtime)
  - path: /forms/[id]/entries
    page: EntryList
    roles: []
    authz: { entity: entries, verb: read }
  - path: /forms/[id]/entries/new
    page: EntryEdit
    roles: []
    authz: { entity: entries, verb: write, require_create: true }
  - path: /forms/[id]/entries/[entryId]
    page: EntryDetail
    roles: []
    authz: { entity: entries, verb: read }
  - path: /forms/[id]/entries/[entryId]/edit
    page: EntryEdit
    roles: []
    authz: { entity: entries, verb: write }

# Navigation contributions
# Note: Navigation is handled via runtime injection in runtime-forms-nav.ts
# which creates the "Custom Forms" parent with published forms as children.
# No static nav contribution needed here.
nav: []

# Schema contributions (Drizzle tables)
schema:
  source: src/schema/forms.ts
  exports: [forms, formVersions, formFields, formEntries, formEntryHistory, formsAcls, formsPrincipalTypeEnum]

# API routes expected by this pack
# Handlers are exported from the feature pack and imported at runtime
api:
  routes:
    - path: /api/forms
      methods: [GET, POST]
      handler: "@hit/feature-pack-form-core/server/api/forms"
      description: "List forms (GET) or create form (POST)"
    - path: /api/forms/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-form-core/server/api/forms-id"
      description: "Get, update, or delete a form"
    - path: /api/forms/[id]/schema
      methods: [GET]
      handler: "@hit/feature-pack-form-core/server/api/forms-id-schema"
      description: "Get a platform-agnostic schema for a form (fields + configs) for non-React clients"
    - path: /api/forms/[id]/entries
      methods: [GET, POST]
      handler: "@hit/feature-pack-form-core/server/api/entries"
      description: "List entries (GET) or create entry (POST)"
    - path: /api/forms/[id]/entries/[entryId]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-form-core/server/api/entries-id"
      description: "Get, update, or delete an entry"
    - path: /api/forms/[id]/acl
      methods: [GET, POST]
      handler: "@hit/feature-pack-form-core/server/api/acl"
      description: "List ACLs (GET) or create ACL entry (POST) for a form"
    - path: /api/forms/[id]/acl/[aclId]
      methods: [DELETE]
      handler: "@hit/feature-pack-form-core/server/api/acl"
      description: "Delete an ACL entry"
    - path: /api/forms/linked
      methods: [GET]
      handler: "@hit/feature-pack-form-core/server/api/linked"
      description: "List published forms linked to an entity via entity_reference fields (dynamic entity tabs)"

requires:
  modules: []

dependencies:
  feature_packs:
    - name: erp-shell-core

# Configurable options
config:
  schema:
    enable_history:
      type: boolean
      default: true
      description: "Write entry snapshots on update/delete."
    enable_reference_fields:
      type: boolean
      default: true
      description: "Enable reference field type and picker UI."

# ─────────────────────────────────────────────────────────────────────────────
# PERMISSIONS - Action definitions (for admin-core permissions UI + runtime checks)
# ─────────────────────────────────────────────────────────────────────────────
# Permissions are schema-driven and live under:
#   schema/permissions.yaml
